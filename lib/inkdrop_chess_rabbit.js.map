{"version":3,"file":"inkdrop_chess_rabbit.js","names":["_inkdrop","require","inkdrop","onEditorLoad","cm","editor","mde","getActiveEditor","console","log","_default","exports","default","activate","isEditorActive","handleEvent","bind","global","markdownRenderer","remarkCodeComponents","pgn","deactivate","off","functionOnDrop","commands","add","wrapper","e","files","stopPropagation","insertPgn","on","pgnContents","dataTransfer","getData","importPgn","cursorPosition","getCursor","replaceSelection","fetch","method","headers","body","URLSearchParams"],"sources":["../source/inkdrop_chess_rabbit.ts"],"sourcesContent":["// import { iframe } from \"electron\";\nimport { markdownRenderer } from \"inkdrop\";\n\ninkdrop.onEditorLoad(() => {\n    const cm = editor.cm;\n    const mde = inkdrop.getActiveEditor();\n    console.log(mde);\n});\nexport default {\n    activate() {\n        // global.inkdrop.onEditorLoad(() => {\n        //     const mde = inkdrop.getActiveEditor();\n        //     inkdrop.commands.add(mde.wrapper.wrapper, {\n        //         \"editor:insert-images\": (e) => {\n        //             const { files } = e;\n        //             console.log(\"files dropped:\", e);\n\n        //             e.stopPropagation();\n        //         },\n        //     });\n        // });\n        console.log(\"Chess Rabbit ready to run ...\");\n        const mde = inkdrop.getActiveEditor();\n        console.log(mde);\n        if (inkdrop.isEditorActive()) {\n            this.handleEvent.bind(this)(inkdrop.getActiveEditor());\n        } else {\n            global.inkdrop.onEditorLoad(this.handleEvent.bind(this));\n        }\n        if (markdownRenderer) {\n            markdownRenderer.remarkCodeComponents.pgn = pgn;\n            debugger;\n        }\n    },\n\n    deactivate() {\n        inkdrop.getActiveEditor().cm.off(\"drop\", this.functionOnDrop);\n        if (markdownRenderer) {\n            markdownRenderer.remarkCodeComponents.pgn = null;\n        }\n    },\n\n    handleEvent(editor) {\n        const cm = editor.cm;\n        const mde = inkdrop.getActiveEditor();\n        console.log(mde);\n        debugger;\n\n        inkdrop.commands.add(mde.wrapper.wrapper, {\n            \"editor:insert-images\": (e) => {\n                const { files } = e;\n                console.log(\"files dropped:\", e);\n\n                e.stopPropagation();\n\n                this.functionOnDrop = this.insertPgn.bind(this);\n\n                cm.on(\"drop\", this.functionOnDrop);\n            },\n        });\n    },\n\n    async insertPgn(cm, e) {\n        const pgnContents = e.dataTransfer.getData();\n        console.log(pgnContents);\n        debugger;\n\n        if (!pgnContents) {\n            return false;\n        }\n\n        await this.importPgn(pgnContents);\n        // function (imageArrayBuffer) {\n        //    const imageBuffer = Buffer.from(imageArrayBuffer);\n        //    const imageNativeImage = nativeImage.createFromBuffer(imageBuffer);\n\n        //    if (imageNativeImage.isEmpty()) {\n        //        return false;\n        //    }\n\n        const cursorPosition = cm.getCursor();\n\n        // HACK: When the editor is opened in a separate window, delete inserted URL.\n        cm.replaceSelection(\"\");\n\n        //             inkdrop.commands.dispatch(document.body, \"editor:insert-images\", {\n        //                 pos: {\n        //                     line: cursorPosition.line,\n        //                     ch: cursorPosition.ch,\n        //                 },\n        //                 files: [imageNativeImage],\n        //             });\n        // }\n    },\n\n    async importPgn(pgnContents) {\n        // const xhr = new XMLHttpRequest();\n        // xhr.onreadystatechange = function () {\n        //     if (xhr.readyState == 4) {\n        //         callback(this.response);\n        //     }\n        // };\n        // xhr.responseType = \"arraybuffer\";\n        // xhr.open(\"POST\", \"https://lichess.org/api/import\", {\n        //     pgn: pgnContents,\n        // });\n        // xhr.send();\n\n        await fetch(\"https://lichess.org/api/import\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n            body: new URLSearchParams({ pgn: pgnContents }),\n        });\n    },\n};\n"],"mappings":"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","ignoreList":[]}